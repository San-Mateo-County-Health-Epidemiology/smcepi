<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>Creating life tables — make_life_table • smcepi</title><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet"><link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet"><script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Creating life tables — make_life_table"><meta name="description" content="This function creates a life table based on the life table from Public Health England that lives here. It is designed to work with grouped data so that you can calculate life tables for multiple groups at once."><meta property="og:description" content="This function creates a life table based on the life table from Public Health England that lives here. It is designed to work with grouped data so that you can calculate life tables for multiple groups at once."></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-secondary" data-bs-theme="dark" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">smcepi</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.2.0</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="active nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles"><li><a class="dropdown-item" href="../articles/azure_helpers_overview.html">Azure Helpers</a></li>
    <li><a class="dropdown-item" href="../articles/file-management.html">Misc File Management</a></li>
    <li><a class="dropdown-item" href="../articles/life-expectancy-overview.html">Life Expectancy</a></li>
    <li><a class="dropdown-item" href="../articles/smc-geographies.html">San Mateo Geography Functions</a></li>
    <li><a class="dropdown-item" href="../articles/style_guide_templates.html">Style Guide Templates</a></li>
  </ul></li>
      </ul><ul class="navbar-nav"><li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json"></form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/San-Mateo-County-Health-Epidemiology/smcepi/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul></div>


  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Creating life tables</h1>
      <small class="dont-index">Source: <a href="https://github.com/San-Mateo-County-Health-Epidemiology/smcepi/blob/main/R/life-expectancy.R" class="external-link"><code>R/life-expectancy.R</code></a></small>
      <div class="d-none name"><code>make_life_table.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p>This function creates a life table based on the life table from Public Health England that lives <a href="https://fingertips.phe.org.uk/documents/phe%20life%20expectancy%20calculator.xlsm" class="external-link">here</a>. It is designed to work with grouped data so that you can calculate life tables for multiple groups at once.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">make_life_table</span><span class="op">(</span><span class="va">data</span>,</span>
<span>                grouping_vars <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>                age_cat_var <span class="op">=</span> <span class="st">"age_cat"</span>,</span>
<span>                deaths_var <span class="op">=</span> <span class="st">"deaths"</span>,</span>
<span>                population_var <span class="op">=</span> <span class="st">"population"</span><span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>


<dl><dt id="arg-data">data<a class="anchor" aria-label="anchor" href="#arg-data"></a></dt>
<dd><p>a 2x2 data frame with variables for age categories, population years and death count.</p></dd>


<dt id="arg-grouping-vars">grouping_vars<a class="anchor" aria-label="anchor" href="#arg-grouping-vars"></a></dt>
<dd><p>a list of variables used to group the output.</p></dd>


<dt id="arg-age-cat-var">age_cat_var<a class="anchor" aria-label="anchor" href="#arg-age-cat-var"></a></dt>
<dd><p>the name of the variable with age categories if the variable has a name other than "age_cat". Age categories should be in the format <code>start_age-end_age</code>, ex: <code>0-4</code>, <code>5-9</code>, etc</p></dd>


<dt id="arg-deaths-var">deaths_var<a class="anchor" aria-label="anchor" href="#arg-deaths-var"></a></dt>
<dd><p>the name of the variable with death counts if the variable has a name other than "deaths"</p></dd>


<dt id="arg-population-var">population_var<a class="anchor" aria-label="anchor" href="#arg-population-var"></a></dt>
<dd><p>the name of the variable with the population years if the variable has a name other than "population"</p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="value">Value<a class="anchor" aria-label="anchor" href="#value"></a></h2>
    <p>a data frame with a variable for each of the columns in the PHE life table</p>
    </div>

    <div class="section level2">
    <h2 id="ref-examples">Examples<a class="anchor" aria-label="anchor" href="#ref-examples"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="co"># step 1: generate data from which to calculate life expectancy</span></span></span>
<span class="r-in"><span><span class="va">test_data</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span></span></span>
<span class="r-in"><span>  group <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="st">"phe"</span>, <span class="fl">20</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="st">"simulated"</span>, <span class="fl">20</span><span class="op">)</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>  ages <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"0"</span>, <span class="st">"1-4"</span>, <span class="st">"5-9"</span>, <span class="st">"10-14"</span>, <span class="st">"15-19"</span>,<span class="st">"20-24"</span>, <span class="st">"25-29"</span>, <span class="st">"30-34"</span>, <span class="st">"35-39"</span>, <span class="st">"40-44"</span>,</span></span>
<span class="r-in"><span>  <span class="st">"45-49"</span>, <span class="st">"50-54"</span>, <span class="st">"55-59"</span>, <span class="st">"60-64"</span>, <span class="st">"65-69"</span>, <span class="st">"70-74"</span>, <span class="st">"75-79"</span>, <span class="st">"80-84"</span>, <span class="st">"85-89"</span>, <span class="st">"90+"</span><span class="op">)</span>, <span class="fl">2</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>  deaths <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">206</span>, <span class="fl">37</span>, <span class="fl">23</span>, <span class="fl">23</span>, <span class="fl">105</span>, <span class="fl">162</span>, <span class="fl">268</span>, <span class="fl">314</span>, <span class="fl">413</span>, <span class="fl">584</span>, <span class="fl">954</span>,</span></span>
<span class="r-in"><span>            <span class="fl">1359</span>, <span class="fl">1912</span>, <span class="fl">2824</span>, <span class="fl">4507</span>, <span class="fl">5851</span>, <span class="fl">7117</span>, <span class="fl">8192</span>, <span class="fl">7745</span>, <span class="fl">6442</span>,</span></span>
<span class="r-in"><span>            <span class="fl">232</span>, <span class="fl">30</span>, <span class="fl">41</span>, <span class="fl">22</span>, <span class="fl">194</span>, <span class="fl">168</span>, <span class="fl">315</span>, <span class="fl">313</span>, <span class="fl">406</span>, <span class="fl">643</span>, <span class="fl">963</span>,</span></span>
<span class="r-in"><span>            <span class="fl">1446</span>, <span class="fl">1979</span>, <span class="fl">2814</span>, <span class="fl">4587</span>, <span class="fl">5874</span>, <span class="fl">7111</span>, <span class="fl">8221</span>, <span class="fl">7825</span>, <span class="fl">6540</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>  population_est <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">50698</span>, <span class="fl">215400</span>, <span class="fl">280458</span>, <span class="fl">258105</span>, <span class="fl">282062</span>, <span class="fl">329060</span>, <span class="fl">306097</span>, <span class="fl">274544</span>, <span class="fl">260415</span>,</span></span>
<span class="r-in"><span>           <span class="fl">267450</span>, <span class="fl">311314</span>, <span class="fl">324311</span>, <span class="fl">296825</span>, <span class="fl">271339</span>, <span class="fl">284608</span>, <span class="fl">228062</span>, <span class="fl">162785</span>, <span class="fl">111263</span>, <span class="fl">58987</span>, <span class="fl">26016</span>,</span></span>
<span class="r-in"><span>           <span class="fl">51578</span>, <span class="fl">215512</span>, <span class="fl">279462</span>, <span class="fl">257256</span>, <span class="fl">282348</span>, <span class="fl">329111</span>, <span class="fl">306514</span>, <span class="fl">274397</span>, <span class="fl">259847</span>, <span class="fl">267045</span>,</span></span>
<span class="r-in"><span>           <span class="fl">311791</span>, <span class="fl">323739</span>, <span class="fl">297453</span>, <span class="fl">271344</span>, <span class="fl">285047</span>, <span class="fl">227655</span>, <span class="fl">162922</span>, <span class="fl">110554</span>, <span class="fl">58886</span>, <span class="fl">26243</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># step 2: create a life table using the methods from Public Health England .xlsm file</span></span></span>
<span class="r-in"><span><span class="va">le_table</span> <span class="op">&lt;-</span> <span class="fu">make_life_table</span><span class="op">(</span>data <span class="op">=</span> <span class="va">test_data</span>,</span></span>
<span class="r-in"><span>                            grouping_vars <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"group"</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>                            age_cat_var <span class="op">=</span> <span class="st">"ages"</span>,</span></span>
<span class="r-in"><span>                            population_var <span class="op">=</span> <span class="st">"population_est"</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># step 3: pull out the life expectancy for each group</span></span></span>
<span class="r-in"><span><span class="co">## 3a: get le for age 0 (typical estimation used) with confidence intervals</span></span></span>
<span class="r-in"><span><span class="fu"><a href="get_le.html">get_le</a></span><span class="op">(</span><span class="va">le_table</span>, grouping_vars <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"group"</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>        group obs_le_int ci_low_95 ci_high_95</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 1        phe   78.32451      78.2       78.4</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 21 simulated   77.99384      77.9       78.1</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">## 3b. get le for the age group starting at 30 without confidence intervals</span></span></span>
<span class="r-in"><span><span class="fu"><a href="get_le.html">get_le</a></span><span class="op">(</span><span class="va">le_table</span>, start_age <span class="op">=</span> <span class="fl">30</span>, grouping_vars <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"group"</span><span class="op">)</span>, include_ci <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>        group obs_le_int</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 8        phe   49.23220</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 28 simulated   49.08431</span>
<span class="r-in"><span></span></span>
</code></pre></div>
    </div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by The package maintainer.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.3.</p>
</div>

    </footer></div>





  </body></html>

