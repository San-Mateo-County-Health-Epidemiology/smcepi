<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="smcepi">
<title>Azure Helpers • smcepi</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@v1.0.1/dist/bootstrap-toc.min.js" integrity="sha256-4veVQbu7//Lk5TSmc7YV48MxtMy98e26cf5MrgZYnwo=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.11/clipboard.min.js" integrity="sha512-7O5pXpc0oCRrxk8RUfDYFgn0nO1t+jLuIOQdOMRp4APB7uZ4vSjspzp5y6YDtDs4VzUSTbWzBFZ/LKJhnyFOKw==" crossorigin="anonymous" referrerpolicy="no-referrer"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Azure Helpers">
<meta property="og:description" content="smcepi">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-light" data-bs-theme="light"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">smcepi</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.1.0</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="active nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-articles">Articles</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-articles">
    <a class="dropdown-item" href="../articles/azure_helpers_overview.html">Azure Helpers</a>
  </div>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav">
<li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/San-Mateo-County-Health-Epidemiology/smcepi/" aria-label="github">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>

    
  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="" class="logo" alt=""><h1>Azure Helpers</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/San-Mateo-County-Health-Epidemiology/smcepi/blob/HEAD/vignettes/azure_helpers_overview.Rmd" class="external-link"><code>vignettes/azure_helpers_overview.Rmd</code></a></small>
      <div class="d-none name"><code>azure_helpers_overview.Rmd</code></div>
    </div>

    
    
<p>The Azure helper functions are meant to help people who process data
primarily in R but store data in Azure. The functions are wrapper
functions that lean heavily on the <a href="https://dbi.r-dbi.org/" class="external-link">DBI</a> package.</p>
<div class="section level2">
<h2 id="connect_azure">
<code>connect_azure()</code><a class="anchor" aria-label="anchor" href="#connect_azure"></a>
</h2>
</div>
<div class="section level2">
<h2 id="basic-usage">Basic usage<a class="anchor" aria-label="anchor" href="#basic-usage"></a>
</h2>
<p>This is a wrapper around the <code><a href="https://dbi.r-dbi.org/reference/dbConnect.html" class="external-link">DBI::dbConnect()</a></code> function.
The only required input is a <code>.yml</code> file that contains
credentials for connecting to the database.</p>
<p>The function expects a <code>.yml</code> file that includes values
for: <code>server</code>, <code>driver</code>,
<code>authenticator</code>, <code>database</code>,
<code>uid_suffix</code> and <code>port</code>. Here’s an example
<code>.yml</code> file template:</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">default</span><span class="op">:</span></span>
<span>  <span class="va">db</span><span class="op">:</span></span>
<span>    <span class="va">server</span><span class="op">:</span> <span class="st">'server-name'</span></span>
<span>    <span class="va">driver</span><span class="op">:</span> <span class="st">'ODBC Driver 18 for SQL Server'</span></span>
<span>    <span class="va">authenticator</span><span class="op">:</span> <span class="st">'ActivedirectoryPassword'</span></span>
<span>    <span class="va">database</span><span class="op">:</span> <span class="st">'database-name'</span></span>
<span>    <span class="va">uid_suffix</span><span class="op">:</span> <span class="st">'@organization.org'</span></span>
<span>    <span class="va">port</span><span class="op">:</span> <span class="va">port</span><span class="op">-</span><span class="va">number</span></span></code></pre></div>
<p>When you pass the <code>.yml</code> file through the function, you’ll
be prompted to enter your Windows password and then will be connected to
the Azure database you’ve specified in the <code>.yml</code> file.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">azure_con</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/connect_azure.html">connect_azure</a></span><span class="op">(</span>creds_file <span class="op">=</span> <span class="st">"*.yml"</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="additional-options">Additional options<a class="anchor" aria-label="anchor" href="#additional-options"></a>
</h2>
<div class="section level3">
<h3 id="creds_position">
<code>creds_position</code><a class="anchor" aria-label="anchor" href="#creds_position"></a>
</h3>
<p>If you have multiple sets of credentials stored in your
<code>.yml</code> file, you can select which set you’d like to use by
specifying the position of the credentials.</p>
<p>Let’s say your <code>.yml</code> file looks like this:</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">default</span><span class="op">:</span></span>
<span>  <span class="va">db_1</span><span class="op">:</span></span>
<span>    <span class="va">server</span><span class="op">:</span> <span class="st">'server-name'</span></span>
<span>    <span class="va">driver</span><span class="op">:</span> <span class="st">'ODBC Driver 18 for SQL Server'</span></span>
<span>    <span class="va">authenticator</span><span class="op">:</span> <span class="st">'ActivedirectoryPassword'</span></span>
<span>    <span class="va">database</span><span class="op">:</span> <span class="st">'database-name'</span></span>
<span>    <span class="va">uid_suffix</span><span class="op">:</span> <span class="st">'@organization.org'</span></span>
<span>    <span class="va">port</span><span class="op">:</span> <span class="va">port</span><span class="op">-</span><span class="va">number</span></span>
<span>  </span>
<span>  <span class="va">db_2</span><span class="op">:</span></span>
<span>    <span class="va">server</span><span class="op">:</span> <span class="st">'server-name'</span></span>
<span>    <span class="va">driver</span><span class="op">:</span> <span class="st">'ODBC Driver 18 for SQL Server'</span></span>
<span>    <span class="va">authenticator</span><span class="op">:</span> <span class="st">'ActivedirectoryPassword'</span></span>
<span>    <span class="va">database</span><span class="op">:</span> <span class="st">'database-name'</span></span>
<span>    <span class="va">uid_suffix</span><span class="op">:</span> <span class="st">'@organization.org'</span></span>
<span>    <span class="va">port</span><span class="op">:</span> <span class="va">port</span><span class="op">-</span><span class="va">number</span></span></code></pre></div>
<p>If you want to use the second set of credentials (<code>db_2</code>)
instead of the first set (<code>db_1</code>) you should set
<code>creds_position = 2</code>:</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">azure_con</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/connect_azure.html">connect_azure</a></span><span class="op">(</span>creds_file <span class="op">=</span> <span class="st">"*.yml"</span>,</span>
<span>                           creds_position <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="pwd">
<code>pwd</code><a class="anchor" aria-label="anchor" href="#pwd"></a>
</h3>
<p>By default, <code><a href="../reference/connect_azure.html">connect_azure()</a></code> allows you to manually enter
your password when you run the function. If you prefer to use a stored
password, you can override the default using the <code>pwd</code>
argument.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">azure_con</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/connect_azure.html">connect_azure</a></span><span class="op">(</span>creds_file <span class="op">=</span> <span class="st">"*.yml"</span>,</span>
<span>                           pwd <span class="op">=</span> <span class="va">stored_password</span><span class="op">)</span></span></code></pre></div>
</div>
</div>
<div class="section level2">
<h2 id="azure_import_loop">
<code>azure_import_loop()</code><a class="anchor" aria-label="anchor" href="#azure_import_loop"></a>
</h2>
<p>This function creates a table in Azure from R. It is a wrapper
function for the <code><a href="https://dbi.r-dbi.org/reference/dbWriteTable.html" class="external-link">DBI::dbWriteTable()</a></code> and the
<code><a href="https://dbi.r-dbi.org/reference/dbAppendTable.html" class="external-link">DBI::dbAppendTable()</a></code> functions. First, this function breaks
the dataset to be imported into smaller groups and then it loops through
the groups. The first group is used to create the table and subsequent
groups are appended to the table.</p>
<p>This function is helpful for writing large datasets from R to Azure.
Small datasets can be sent from R to Azure just using the
<code><a href="https://dbi.r-dbi.org/reference/dbWriteTable.html" class="external-link">DBI::dbWriteTable()</a></code> function.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/azure_import_loop.html">azure_import_loop</a></span><span class="op">(</span>azure_con <span class="op">=</span> <span class="va">azure_con</span>,</span>
<span>                  data <span class="op">=</span> <span class="va">data</span>,</span>
<span>                  group_size <span class="op">=</span> <span class="fl">500</span>,</span>
<span>                  table_name <span class="op">=</span> <span class="st">"new_azure_table_name"</span>,</span>
<span>                  field_types <span class="op">=</span> <span class="va">varchar_max</span><span class="op">)</span></span></code></pre></div>
<p>Arugments:</p>
<ul>
<li>
<code>azure_con</code>: A DBI Connection object as returned by
<code>dbConnect()</code>. You can also create this using the
<code><a href="../reference/connect_azure.html">smcepi::connect_azure()</a></code> function. See help text for
<code><a href="https://dbi.r-dbi.org/reference/dbWriteTable.html" class="external-link">DBI::dbWriteTable()</a></code> for technical details.</li>
<li>
<code>data</code>: A data.frame object you plan to import</li>
<li>
<code>group_size</code>: An integer that indicates the size of the
import groups. Ex: a group_size of 50 would split the dataset into
groups of 50 records and would then import each group at a time</li>
<li>
<code>table_name</code>: A string to specify the name of the table
in Azure</li>
<li>
<code>field_types</code>: Optional parameter to pass a list of
varchar(<code>n</code>) lengths for the Azure table. Can be created with
the <code><a href="../reference/varchar_max.html">smcepi::varchar_max()</a></code> function</li>
</ul>
</div>
<div class="section level2">
<h2 id="varchar_max">
<code>varchar_max()</code><a class="anchor" aria-label="anchor" href="#varchar_max"></a>
</h2>
<p>Use this to generate a list of varchar(<code>n</code>) specifications
to be used in an R to Azure import with the
<code>DBI:dbWriteTable()</code> or
<code><a href="../reference/azure_import_loop.html">smcepi::azure_import_loop()</a></code> functions.</p>
<p>This list specifies a <code>varchar(n)</code> value for each
character variable based on the maximum string length in that variable.
<code>n</code> is 255 for variables with maximum string lengths of 255
or less and <code>n</code> is the maximum string length for variables
with maximum string lengths longer than 255.</p>
<p>Pass the dataset you plan to import into this function to get the
<code>varchar(n)</code> fields for your import:</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">data</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span></span>
<span>          col1 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"blue"</span>, <span class="st">"pink"</span>, <span class="st">"green"</span>, <span class="st">"yellow"</span><span class="op">)</span>,</span>
<span>          col2 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="st">"a"</span>, <span class="fl">1000</span><span class="op">)</span>, collapse <span class="op">=</span> <span class="st">""</span><span class="op">)</span>, <span class="st">"b"</span>, <span class="st">"cc"</span>, <span class="st">"ddd"</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="fu">smcepi</span><span class="fu">::</span><span class="fu"><a href="../reference/varchar_max.html">varchar_max</a></span><span class="op">(</span><span class="va">data</span><span class="op">)</span></span>
<span><span class="co">#&gt;            col1            col2 </span></span>
<span><span class="co">#&gt;  "varchar(255)" "varchar(1000)"</span></span></code></pre></div>
</div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by The package maintainer.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.9.</p>
</div>

    </footer>
</div>

  

  

  </body>
</html>
